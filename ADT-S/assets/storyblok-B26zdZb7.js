import{f as g,g as $}from"./index-bPnPnLSG.js";const m=g({}),d=g({}),p={maxRetries:3,retryDelay:1e3,cacheEnabled:!0},C=async(t,s={})=>{const o={...p,...s},{maxRetries:e,retryDelay:l,cacheEnabled:r}=o,a=s.params||{version:"published"},u=$();if(r&&d.value[t])return console.log(`Loading story from cache: ${t}`),{data:d.value[t],status:"success",fromCache:!0};let n=0,i=null;for(;n<e;)try{const c=await u.get(`cdn/stories/${t}`,a);return r&&(d.value[t]=c.data.story),{data:c.data.story,status:"success",fromCache:!1}}catch(c){n++,i=c,console.error(`Failed to load story (attempt ${n}/${e}): ${t}`,c),n<e&&await new Promise(f=>setTimeout(f,l*n))}return{data:null,status:"error",error:i,fromCache:!1}},y=async(t={})=>{const s=$(),o={version:"published",...t.params};t.startsWith&&(o.starts_with=t.startsWith);try{const e=await s.get("cdn/stories",o);return p.cacheEnabled&&e.data.stories.forEach(l=>{const r=l.full_slug;if(d.value[r]=l,r.startsWith("projects/")){const a=r.split("/").pop();m.value[a]=l}}),{data:e.data.stories,status:"success"}}catch(e){return console.error("Failed to load stories:",e),{data:[],status:"error",error:e}}},U=async()=>{const t=await y({startsWith:"projects/"});return t.status==="success"&&console.log("Preloaded projects to cache:",t.data.map(s=>s.slug.split("/").pop())),t},k=(t,s={})=>{if(!t||!Array.isArray(t)||t.length===0)return console.warn("No visuals found or invalid visuals format"),[];const{width:o=0,height:e=230,quality:l=70,format:r="webp"}=s;return t.map(a=>({url:b(a.filename,s),alt:a.alt||"Image"}))},I=(t,s={})=>{if(!t||!t.content)return console.warn("Invalid project or missing content:",t),h(s);const{width:o=0,height:e=690,quality:l=75,format:r=null}=s;if(t.content.visuals&&Array.isArray(t.content.visuals)&&t.content.visuals.length>0){const a=t.content.visuals[0].filename;console.log(`Found image filename: ${a} for project: ${t.name||t.slug}`);let u=`/m/${o}x${e}`;const n=[];l&&n.push(`quality(${l})`),r&&n.push(`format(${r})`),n.length>0&&(u+=`/filters:${n.join(":")}`);let i;return a.includes("storyblok.com")?i=`${a.split("/m/")[0]}${u}`:i=`${a}${u}`,console.log(`Generated image URL: ${i}`),i=i+(i.includes("?")?"&":"?")+"v="+Date.now(),i}else return console.warn(`No visuals found for project: ${t.name||t.slug}`),h(s)},h=(t={})=>"",b=(t,s={})=>{if(!t)return console.warn("No filename provided for image transformation"),"";const{width:o=0,height:e=230,quality:l=70,format:r=null,crop:a=null,fit:u=null}=s,n=o>0?Math.round(o):0,i=e>0?Math.round(e):0;let c=`/m/${n}x${i}`;const f=[];return l&&f.push(`quality(${l})`),r&&f.push(`format(${r})`),a&&f.push(`crop(${a})`),u&&f.push(`fit(${u})`),f.length>0&&(c+=`/filters:${f.join(":")}`),t.includes("storyblok.com")?`${t.split("/m/")[0]}${c}`:`${t}${c}`},q=(t="all")=>{(t==="all"||t==="projects")&&(m.value={}),(t==="all"||t==="stories")&&(d.value={}),console.log(`Cache cleared: ${t}`)},A=()=>{const t=Object.keys(m.value);return t.length>0?{slug:t[0],data:m.value[t[0]]}:null},j=(t={})=>{const{width:s=0,height:o=230,quality:e=70}=t;return{width:s,height:o,quality:e,appliedRatio:1}},x={projects:m,stories:d};export{k as a,q as b,x as c,C as d,b as e,I as f,A as g,j as h,y as l,U as p};
